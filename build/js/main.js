"use strict";

//fade-in when visible
document.addEventListener("DOMContentLoaded", function () {
  var elements = document.querySelectorAll(".fade-in, .slideInLeft, .slideInRight, .fadeInFromTop");
  function checkVisibility() {
    elements.forEach(function (el) {
      var rect = el.getBoundingClientRect();
      if (rect.top < window.innerHeight * 0.9) {
        el.classList.add("visible");
      }
    });
  }
  window.addEventListener("scroll", checkVisibility);
  checkVisibility();
});

//open form block
document.addEventListener("DOMContentLoaded", function () {
  var btn = document.querySelector(".header__content-btn");
  var form = document.querySelector(".firstForm");
  btn.addEventListener("click", function () {
    if (form.style.display === "none" || form.style.display === "") {
      form.style.display = "block";
      btn.textContent = "Згорнути";
    } else {
      form.style.display = "none";
      btn.textContent = "Доєднатись";
    }
  });
});

//slider

document.addEventListener("DOMContentLoaded", function () {
  var sliderWrapper = document.querySelector(".slider__wrapper");
  var slides = document.querySelectorAll(".slider__slide");
  var prevBtn = document.querySelector(".slider__btn-prev");
  var nextBtn = document.querySelector(".slider__btn-next");
  var dotsContainer = document.querySelector(".slider__dots");
  var currentIndex = 0;
  var interval;
  function updateSlider() {
    slides.forEach(function (slide, index) {
      slide.style.display = index === currentIndex ? "flex" : "none";
    });
    document.querySelectorAll(".slider__dot").forEach(function (dot, index) {
      dot.classList.toggle("active", index === currentIndex);
    });
  }
  function nextSlide() {
    currentIndex = (currentIndex + 1) % slides.length;
    updateSlider();
  }
  function prevSlide() {
    currentIndex = (currentIndex - 1 + slides.length) % slides.length;
    updateSlider();
  }
  function startAutoSlide() {
    interval = setInterval(nextSlide, 3000);
  }
  function stopAutoSlide() {
    clearInterval(interval);
  }
  slides.forEach(function (_, index) {
    var dot = document.createElement("span");
    dot.classList.add("slider__dot");
    dot.addEventListener("click", function () {
      currentIndex = index;
      updateSlider();
    });
    dotsContainer.appendChild(dot);
  });
  prevBtn.addEventListener("click", prevSlide);
  nextBtn.addEventListener("click", nextSlide);
  updateSlider();
  startAutoSlide();
});

//form

document.addEventListener("DOMContentLoaded", function () {
  var forms = document.querySelectorAll('form'); // Все формы на странице

  forms.forEach(function (form) {
    var phoneInput = form.querySelector('.form__input-phone');
    var dateInput = form.querySelector('.form__input-date');
    var regionInput = form.querySelector('.form__input-region');
    var checkboxInput = form.querySelector('.form__input-checkbox');
    var radioInputs = form.querySelectorAll('input[name="yes-no"]'); // Для проверки военнослужащего
    var submitButton = form.querySelector('.form__submit');
    var allInputs = form.querySelectorAll('.form__input');
    var telegramInput = form.querySelector('.form__input-telegram'); // Нік в телеграмі
    var formWarning = form.querySelector('.form__warning'); // Контейнер для предупреждений

    // telephone
    phoneInput.addEventListener('focus', function () {
      if (phoneInput.value.trim() === '') {
        phoneInput.value = '+38'; // Автозаполнение при фокусе
      }
    });
    phoneInput.addEventListener('input', function () {
      var value = this.value.replace(/\D/g, '');
      if (value.length > 1) {
        value = '+38 ' + value.slice(2, 5) + ' ' + value.slice(5, 8) + ' ' + value.slice(8, 10) + ' ' + value.slice(10, 12);
      } else {
        value = '+38';
      }
      this.value = value;
    });

    //input
    form.addEventListener('input', function (event) {
      var targetInput = event.target;
      if (targetInput.classList.contains('warning')) {
        validateSingleInput(targetInput);
      }
      var isAnyInputFilled = Array.from(allInputs).some(function (input) {
        return input.value.trim() !== "" || input.checked;
      });
      if (isAnyInputFilled) {
        submitButton.classList.add('active');
      } else {
        submitButton.classList.remove('active');
      }
    });

    // check 1 input
    function validateSingleInput(input) {
      if (input.type === "date" && input.value === "2000-01-01") {
        input.classList.add('warning');
      } else if (input.value.trim() === "" || input.classList.contains('form__input-phone') && !/^\+38\s*\d{3}\s*\d{3}\s*\d{2}\s*\d{2}$/.test(input.value)) {
        input.classList.add('warning');
      } else if (input.classList.contains('form__input-region') && input.value === "") {
        input.classList.add('warning');
      } else if (input.classList.contains('form__input-checkbox') && !input.checked) {
        input.classList.add('warning');
      } else if (input.classList.contains('form__input-radio')) {
        var isRadioChecked = Array.from(radioInputs).some(function (radio) {
          return radio.checked;
        });
        if (!isRadioChecked) {
          radioInputs.forEach(function (radio) {
            return radio.classList.add('warning');
          });
        } else {
          radioInputs.forEach(function (radio) {
            return radio.classList.remove('warning');
          });
        }
      } else {
        input.classList.remove('warning');
      }
    }

    // validation
    function validateInputs(form) {
      var isValid = true;
      var hasWarning = false;
      allInputs.forEach(function (input) {
        if (input === telegramInput) {
          return;
        }
        if (input.type === "date" && input.value === "2000-01-01") {
          input.classList.add('warning');
          hasWarning = true;
          isValid = false;
        } else if (input.value.trim() === "" || input.classList.contains('form__input-phone') && !/^\+38\s*\d{3}\s*\d{3}\s*\d{2}\s*\d{2}$/.test(input.value)) {
          input.classList.add('warning');
          hasWarning = true;
          isValid = false;
        } else if (input.classList.contains('form__input-region') && input.value === "") {
          input.classList.add('warning');
          hasWarning = true;
          isValid = false;
        } else if (input.classList.contains('form__input-checkbox') && !input.checked) {
          input.classList.add('warning');
          hasWarning = true;
          isValid = false;
        } else if (input.classList.contains('form__input-radio')) {
          var isRadioChecked = Array.from(radioInputs).some(function (radio) {
            return radio.checked;
          });
          if (!isRadioChecked) {
            radioInputs.forEach(function (radio) {
              return radio.classList.add('warning');
            });
            hasWarning = true;
            isValid = false;
          } else {
            radioInputs.forEach(function (radio) {
              return radio.classList.remove('warning');
            });
          }
        } else {
          input.classList.remove('warning');
        }
      });
      if (hasWarning) {
        formWarning.classList.add('visible');
      } else {
        formWarning.classList.remove('visible');
      }
      if (isValid) {
        submitButton.classList.remove('warning');
      } else {
        submitButton.classList.add('warning');
      }
    }
    forms.forEach(function (form) {
      form.addEventListener("submit", function (event) {
        event.preventDefault(); // Заблокувати стандартну відправку

        var isValid = true;
        var warnings = form.querySelectorAll(".warning");
        warnings.forEach(function (warning) {
          return warning.classList.remove("warning");
        }); // Очистити попередні помилки

        // Функція для додавання попередження
        var addWarning = function addWarning(input, message) {
          isValid = false;
          input.classList.add("warning");
          var warningMessage = input.nextElementSibling;
          if (!warningMessage || !warningMessage.classList.contains("form__warning")) {
            warningMessage = document.createElement("p");
            warningMessage.classList.add("form__warning");
            warningMessage.textContent = message;
            input.parentNode.appendChild(warningMessage);
          }
        };

        // Валідація текстових полів
        var surname = form.querySelector(".form__input-surname");
        if (!surname.value.trim()) addWarning(surname, "Прізвище обов'язкове");
        var firstName = form.querySelector(".form__input-first-name");
        if (!firstName.value.trim()) addWarning(firstName, "Ім'я обов'язкове");

        // Валідація телефону
        var phone = form.querySelector(".form__input-phone");
        if (!phone.value.trim() || !/^\+38\s?\d{3}\s?\d{3}\s?\d{2}\s?\d{2}$/.test(phone.value)) {
          addWarning(phone, "Номер телефону обов'язковий");
        }

        // Валідація дати народження
        var birthDate = form.querySelector(".form__input-date");
        if (!birthDate.value || birthDate.value === "2000-01-01") {
          addWarning(birthDate, "Дата народження обов'язкова");
        }

        // Валідація військовослужбовця
        var isMilitary = form.querySelector(".form__input-radio:checked");
        if (!isMilitary) addWarning(form.querySelector(".form__input-radio"), "Оберіть варіант");

        // Валідація згоди на обробку даних
        var consent = form.querySelector(".form__input-checkbox");
        if (!consent.checked) addWarning(consent, "Ви повинні погодитися з обробкою даних");
        if (isValid) {
          var formData = new FormData(form); //

          var successMessage = form.querySelector('.form__success');
          if (successMessage) {
            successMessage.classList.add('visible');
            setTimeout(function () {
              successMessage.classList.remove('visible');
              form.reset();
            }, 5000);
            successMessage.addEventListener('click', function () {
              successMessage.classList.remove('visible');
              form.reset();
            });
          }
          fetch(form.action, {
            method: "POST",
            body: formData
          }).then(function (response) {
            return response.text();
          }).then(function (data) {
            // console.log(data); // Вивести відповідь від сервера

            var successMessage = form.querySelector('.form__success');
            var errorMessage = form.querySelector('.form__warning');
            if (data.includes("Дякуємо за вашу заявку!")) {
              // Показати повідомлення про успіх
              if (successMessage) {
                successMessage.classList.add('visible');
                setTimeout(function () {
                  successMessage.classList.remove('visible');
                  form.reset(); // Очистити форму
                }, 5000);
              }
            } else {
              // Показати повідомлення про помилку
              if (errorMessage) {
                errorMessage.textContent = "Помилка при відправці форми. Спробуйте ще раз.";
                errorMessage.classList.add('visible');
              }
            }
          })["catch"](function (error) {
            console.error("Помилка при відправці форми:", error);
            var errorMessage = form.querySelector('.form__warning');
            if (errorMessage) {
              errorMessage.textContent = "Помилка при відправці форми. Спробуйте ще раз.";
              errorMessage.classList.add('visible');
            }
          });
        }
      });
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiXSwibmFtZXMiOlsiZG9jdW1lbnQiLCJhZGRFdmVudExpc3RlbmVyIiwiZWxlbWVudHMiLCJxdWVyeVNlbGVjdG9yQWxsIiwiY2hlY2tWaXNpYmlsaXR5IiwiZm9yRWFjaCIsImVsIiwicmVjdCIsImdldEJvdW5kaW5nQ2xpZW50UmVjdCIsInRvcCIsIndpbmRvdyIsImlubmVySGVpZ2h0IiwiY2xhc3NMaXN0IiwiYWRkIiwiYnRuIiwicXVlcnlTZWxlY3RvciIsImZvcm0iLCJzdHlsZSIsImRpc3BsYXkiLCJ0ZXh0Q29udGVudCIsInNsaWRlcldyYXBwZXIiLCJzbGlkZXMiLCJwcmV2QnRuIiwibmV4dEJ0biIsImRvdHNDb250YWluZXIiLCJjdXJyZW50SW5kZXgiLCJpbnRlcnZhbCIsInVwZGF0ZVNsaWRlciIsInNsaWRlIiwiaW5kZXgiLCJkb3QiLCJ0b2dnbGUiLCJuZXh0U2xpZGUiLCJsZW5ndGgiLCJwcmV2U2xpZGUiLCJzdGFydEF1dG9TbGlkZSIsInNldEludGVydmFsIiwic3RvcEF1dG9TbGlkZSIsImNsZWFySW50ZXJ2YWwiLCJfIiwiY3JlYXRlRWxlbWVudCIsImFwcGVuZENoaWxkIiwiZm9ybXMiLCJwaG9uZUlucHV0IiwiZGF0ZUlucHV0IiwicmVnaW9uSW5wdXQiLCJjaGVja2JveElucHV0IiwicmFkaW9JbnB1dHMiLCJzdWJtaXRCdXR0b24iLCJhbGxJbnB1dHMiLCJ0ZWxlZ3JhbUlucHV0IiwiZm9ybVdhcm5pbmciLCJ2YWx1ZSIsInRyaW0iLCJyZXBsYWNlIiwic2xpY2UiLCJldmVudCIsInRhcmdldElucHV0IiwidGFyZ2V0IiwiY29udGFpbnMiLCJ2YWxpZGF0ZVNpbmdsZUlucHV0IiwiaXNBbnlJbnB1dEZpbGxlZCIsIkFycmF5IiwiZnJvbSIsInNvbWUiLCJpbnB1dCIsImNoZWNrZWQiLCJyZW1vdmUiLCJ0eXBlIiwidGVzdCIsImlzUmFkaW9DaGVja2VkIiwicmFkaW8iLCJ2YWxpZGF0ZUlucHV0cyIsImlzVmFsaWQiLCJoYXNXYXJuaW5nIiwicHJldmVudERlZmF1bHQiLCJ3YXJuaW5ncyIsIndhcm5pbmciLCJhZGRXYXJuaW5nIiwibWVzc2FnZSIsIndhcm5pbmdNZXNzYWdlIiwibmV4dEVsZW1lbnRTaWJsaW5nIiwicGFyZW50Tm9kZSIsInN1cm5hbWUiLCJmaXJzdE5hbWUiLCJwaG9uZSIsImJpcnRoRGF0ZSIsImlzTWlsaXRhcnkiLCJjb25zZW50IiwiZm9ybURhdGEiLCJGb3JtRGF0YSIsInN1Y2Nlc3NNZXNzYWdlIiwic2V0VGltZW91dCIsInJlc2V0IiwiZmV0Y2giLCJhY3Rpb24iLCJtZXRob2QiLCJib2R5IiwidGhlbiIsInJlc3BvbnNlIiwidGV4dCIsImRhdGEiLCJlcnJvck1lc3NhZ2UiLCJpbmNsdWRlcyIsImVycm9yIiwiY29uc29sZSJdLCJtYXBwaW5ncyI6Ijs7QUFBQTtBQUNBQSxRQUFRLENBQUNDLGdCQUFnQixDQUFDLGtCQUFrQixFQUFFLFlBQVk7RUFDdEQsSUFBTUMsUUFBUSxHQUFHRixRQUFRLENBQUNHLGdCQUFnQixDQUFDLHVEQUF1RCxDQUFDO0VBRW5HLFNBQVNDLGVBQWVBLENBQUEsRUFBRztJQUN2QkYsUUFBUSxDQUFDRyxPQUFPLENBQUMsVUFBQUMsRUFBRSxFQUFJO01BQ25CLElBQU1DLElBQUksR0FBR0QsRUFBRSxDQUFDRSxxQkFBcUIsQ0FBQyxDQUFDO01BQ3ZDLElBQUlELElBQUksQ0FBQ0UsR0FBRyxHQUFHQyxNQUFNLENBQUNDLFdBQVcsR0FBRyxHQUFHLEVBQUU7UUFDckNMLEVBQUUsQ0FBQ00sU0FBUyxDQUFDQyxHQUFHLENBQUMsU0FBUyxDQUFDO01BQy9CO0lBQ0osQ0FBQyxDQUFDO0VBQ047RUFFQUgsTUFBTSxDQUFDVCxnQkFBZ0IsQ0FBQyxRQUFRLEVBQUVHLGVBQWUsQ0FBQztFQUNsREEsZUFBZSxDQUFDLENBQUM7QUFDckIsQ0FBQyxDQUFDOztBQUVGO0FBQ0FKLFFBQVEsQ0FBQ0MsZ0JBQWdCLENBQUMsa0JBQWtCLEVBQUUsWUFBWTtFQUN0RCxJQUFN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U0FBUyxDQUFDQyxHQUFHLENBQUMsU0FBUyxDQUFDO2dCQUN2QytFLFVBQVUsQ0FBQyxZQUFNO2tCQUNiRCxjQUFjLENBQUMvRSxTQUFTLENBQUN1RCxNQUFNLENBQUMsU0FBUyxDQUFDO2tCQUMxQ25ELElBQUksQ0FBQzZFLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFDbEIsQ0FBQyxFQUFFLElBQUksQ0FBQztjQUNaO1lBQ0osQ0FBQyxNQUFNO2NBQ0g7Y0FDQSxJQUFJUyxZQUFZLEVBQUU7Z0JBQ2RBLFlBQVksQ0FBQ25GLFdBQVcsR0FBRyxnREFBZ0Q7Z0JBQzNFbUYsWUFBWSxDQUFDMUYsU0FBUyxDQUFDQyxHQUFHLENBQUMsU0FBUyxDQUFDO2NBQ3pDO1lBQ0o7VUFDSixDQUFDLENBQUMsU0FDSSxDQUFDLFVBQUEyRixLQUFLLEVBQUk7WUFDWkMsT0FBTyxDQUFDRCxLQUFLLENBQUMsOEJBQThCLEVBQUVBLEtBQUssQ0FBQztZQUNwRCxJQUFNRixZQUFZLEdBQUd0RixJQUFJLENBQUNELGFBQWEsQ0FBQyxnQkFBZ0IsQ0FBQztZQUN6RCxJQUFJdUYsWUFBWSxFQUFFO2NBQ2RBLFlBQVksQ0FBQ25GLFdBQVcsR0FBRyxnREFBZ0Q7Y0FDM0VtRixZQUFZLENBQUMxRixTQUFTLENBQUNDLEdBQUcsQ0FBQyxTQUFTLENBQUM7WUFDekM7VUFDSixDQUFDLENBQUM7UUFDVjtNQUNKLENBQUMsQ0FBQztJQUNOLENBQUMsQ0FBQztFQUVOLENBQUMsQ0FBQztBQUNOLENBQUMsQ0FBQyIsImZpbGUiOiJtYWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLy9mYWRlLWluIHdoZW4gdmlzaWJsZVxuZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcIkRPTUNvbnRlbnRMb2FkZWRcIiwgZnVuY3Rpb24gKCkge1xuICAgIGNvbnN0IGVsZW1lbnRzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5mYWRlLWluLCAuc2xpZGVJbkxlZnQsIC5zbGlkZUluUmlnaHQsIC5mYWRlSW5Gcm9tVG9wXCIpO1xuXG4gICAgZnVuY3Rpb24gY2hlY2tWaXNpYmlsaXR5KCkge1xuICAgICAgICBlbGVtZW50cy5mb3JFYWNoKGVsID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHJlY3QgPSBlbC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcbiAgICAgICAgICAgIGlmIChyZWN0LnRvcCA8IHdpbmRvdy5pbm5lckhlaWdodCAqIDAuOSkge1xuICAgICAgICAgICAgICAgIGVsLmNsYXNzTGlzdC5hZGQoXCJ2aXNpYmxlXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihcInNjcm9sbFwiLCBjaGVja1Zpc2liaWxpdHkpO1xuICAgIGNoZWNrVmlzaWJpbGl0eSgpO1xufSk7XG5cbi8vb3BlbiBmb3JtIGJsb2NrXG5kb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwiRE9NQ29udGVudExvYWRlZFwiLCBmdW5jdGlvbiAoKSB7XG4gICAgY29uc3QgYnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5oZWFkZXJfX2NvbnRlbnQtYnRuXCIpO1xuICAgIGNvbnN0IGZvcm0gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmZpcnN0Rm9ybVwiKTtcblxuICAgIGJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAoZm9ybS5zdHlsZS5kaXNwbGF5ID09PSBcIm5vbmVcIiB8fCBmb3JtLnN0eWxlLmRpc3BsYXkgPT09IFwiXCIpIHtcbiAgICAgICAgICAgIGZvcm0uc3R5bGUuZGlzcGxheSA9IFwiYmxvY2tcIjtcbiAgICAgICAgICAgIGJ0bi50ZXh0Q29udGVudCA9IFwi0JfQs9C+0YDQvdGD0YLQuFwiO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZm9ybS5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG4gICAgICAgICAgICBidG4udGV4dENvbnRlbnQgPSBcItCU0L7RlNC00L3QsNGC0LjRgdGMXCI7XG4gICAgICAgIH1cbiAgICB9KTtcbn0pO1xuXG4vL3NsaWRlclxuXG5kb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwiRE9NQ29udGVudExvYWRlZFwiLCBmdW5jdGlvbiAoKSB7XG4gICAgY29uc3Qgc2xpZGVyV3JhcHBlciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuc2xpZGVyX193cmFwcGVyXCIpO1xuICAgIGNvbnN0IHNsaWRlcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIuc2xpZGVyX19zbGlkZVwiKTtcbiAgICBjb25zdCBwcmV2QnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5zbGlkZXJfX2J0bi1wcmV2XCIpO1xuICAgIGNvbnN0IG5leHRCdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnNsaWRlcl9fYnRuLW5leHRcIik7XG4gICAgY29uc3QgZG90c0NvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuc2xpZGVyX19kb3RzXCIpO1xuICAgIGxldCBjdXJyZW50SW5kZXggPSAwO1xuICAgIGxldCBpbnRlcnZhbDtcblxuICAgIGZ1bmN0aW9uIHVwZGF0ZVNsaWRlcigpIHtcbiAgICAgICAgc2xpZGVzLmZvckVhY2goKHNsaWRlLCBpbmRleCkgPT4ge1xuICAgICAgICAgICAgc2xpZGUuc3R5bGUuZGlzcGxheSA9IGluZGV4ID09PSBjdXJyZW50SW5kZXggPyBcImZsZXhcIiA6IFwibm9uZVwiO1xuICAgICAgICB9KTtcbiAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5zbGlkZXJfX2RvdFwiKS5mb3JFYWNoKChkb3QsIGluZGV4KSA9PiB7XG4gICAgICAgICAgICBkb3QuY2xhc3NMaXN0LnRvZ2dsZShcImFjdGl2ZVwiLCBpbmRleCA9PT0gY3VycmVudEluZGV4KTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gbmV4dFNsaWRlKCkge1xuICAgICAgICBjdXJyZW50SW5kZXggPSAoY3VycmVudEluZGV4ICsgMSkgJSBzbGlkZXMubGVuZ3RoO1xuICAgICAgICB1cGRhdGVTbGlkZXIoKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBwcmV2U2xpZGUoKSB7XG4gICAgICAgIGN1cnJlbnRJbmRleCA9IChjdXJyZW50SW5kZXggLSAxICsgc2xpZGVzLmxlbmd0aCkgJSBzbGlkZXMubGVuZ3RoO1xuICAgICAgICB1cGRhdGVTbGlkZXIoKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBzdGFydEF1dG9TbGlkZSgpIHtcbiAgICAgICAgaW50ZXJ2YWwgPSBzZXRJbnRlcnZhbChuZXh0U2xpZGUsIDMwMDApO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIHN0b3BBdXRvU2xpZGUoKSB7XG4gICAgICAgIGNsZWFySW50ZXJ2YWwoaW50ZXJ2YWwpO1xuICAgIH1cblxuICAgIHNsaWRlcy5mb3JFYWNoKChfLCBpbmRleCkgPT4ge1xuICAgICAgICBjb25zdCBkb3QgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwic3BhblwiKTtcbiAgICAgICAgZG90LmNsYXNzTGlzdC5hZGQoXCJzbGlkZXJfX2RvdFwiKTtcbiAgICAgICAgZG90LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgICAgICAgICBjdXJyZW50SW5kZXggPSBpbmRleDtcbiAgICAgICAgICAgIHVwZGF0ZVNsaWRlcigpO1xuICAgICAgICB9KTtcbiAgICAgICAgZG90c0NvbnRhaW5lci5hcHBlbmRDaGlsZChkb3QpO1xuICAgIH0pO1xuXG4gICAgcHJldkJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgcHJldlNsaWRlKTtcbiAgICBuZXh0QnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBuZXh0U2xpZGUpO1xuXG4gICAgdXBkYXRlU2xpZGVyKCk7XG4gICAgc3RhcnRBdXRvU2xpZGUoKTtcbn0pO1xuXG4vL2Zvcm1cblxuZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcIkRPTUNvbnRlbnRMb2FkZWRcIiwgKCkgPT4ge1xuICAgIGNvbnN0IGZvcm1zID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnZm9ybScpOyAgLy8g0JLRgdC1INGE0L7RgNC80Ysg0L3QsCDRgdGC0YDQsNC90LjRhtC1XG5cbiAgICBmb3Jtcy5mb3JFYWNoKGZvcm0gPT4ge1xuICAgICAgICBjb25zdCBwaG9uZUlucHV0ID0gZm9ybS5xdWVyeVNlbGVjdG9yKCcuZm9ybV9faW5wdXQtcGhvbmUnKTtcbiAgICAgICAgY29uc3QgZGF0ZUlucHV0ID0gZm9ybS5xdWVyeVNlbGVjdG9yKCcuZm9ybV9faW5wdXQtZGF0ZScpO1xuICAgICAgICBjb25zdCByZWdpb25JbnB1dCA9IGZvcm0ucXVlcnlTZWxlY3RvcignLmZvcm1fX2lucHV0LXJlZ2lvbicpO1xuICAgICAgICBjb25zdCBjaGVja2JveElucHV0ID0gZm9ybS5xdWVyeVNlbGVjdG9yKCcuZm9ybV9faW5wdXQtY2hlY2tib3gnKTtcbiAgICAgICAgY29uc3QgcmFkaW9JbnB1dHMgPSBmb3JtLnF1ZXJ5U2VsZWN0b3JBbGwoJ2lucHV0W25hbWU9XCJ5ZXMtbm9cIl0nKTsgLy8g0JTQu9GPINC/0YDQvtCy0LXRgNC60Lgg0LLQvtC10L3QvdC+0YHQu9GD0LbQsNGJ0LXQs9C+XG4gICAgICAgIGNvbnN0IHN1Ym1pdEJ1dHRvbiA9IGZvcm0ucXVlcnlTZWxlY3RvcignLmZvcm1fX3N1Ym1pdCcpO1xuICAgICAgICBjb25zdCBhbGxJbnB1dHMgPSBmb3JtLnF1ZXJ5U2VsZWN0b3JBbGwoJy5mb3JtX19pbnB1dCcpO1xuICAgICAgICBjb25zdCB0ZWxlZ3JhbUlucHV0ID0gZm9ybS5xdWVyeVNlbGVjdG9yKCcuZm9ybV9faW5wdXQtdGVsZWdyYW0nKTsgLy8g0J3RltC6INCyINGC0LXQu9C10LPRgNCw0LzRllxuICAgICAgICBjb25zdCBmb3JtV2FybmluZyA9IGZvcm0ucXVlcnlTZWxlY3RvcignLmZvcm1fX3dhcm5pbmcnKTsgIC8vINCa0L7QvdGC0LXQudC90LXRgCDQtNC70Y8g0L/RgNC10LTRg9C/0YDQtdC20LTQtdC90LjQuVxuXG4gICAgICAgIC8vIHRlbGVwaG9uZVxuICAgICAgICBwaG9uZUlucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2ZvY3VzJywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgaWYgKHBob25lSW5wdXQudmFsdWUudHJpbSgpID09PSAnJykge1xuICAgICAgICAgICAgICAgIHBob25lSW5wdXQudmFsdWUgPSAnKzM4JzsgLy8g0JDQstGC0L7Qt9Cw0L/QvtC70L3QtdC90LjQtSDQv9GA0Lgg0YTQvtC60YPRgdC1XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHBob25lSW5wdXQuYWRkRXZlbnRMaXN0ZW5lcignaW5wdXQnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBsZXQgdmFsdWUgPSB0aGlzLnZhbHVlLnJlcGxhY2UoL1xcRC9nLCAnJyk7XG5cbiAgICAgICAgICAgIGlmICh2YWx1ZS5sZW5ndGggPiAxKSB7XG4gICAgICAgICAgICAgICAgdmFsdWUgPSAnKzM4ICcgKyB2YWx1ZS5zbGljZSgyLCA1KSArICcgJyArIHZhbHVlLnNsaWNlKDUsIDgpICsgJyAnICsgdmFsdWUuc2xpY2UoOCwgMTApICsgJyAnICsgdmFsdWUuc2xpY2UoMTAsIDEyKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdmFsdWUgPSAnKzM4JztcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhpcy52YWx1ZSA9IHZhbHVlO1xuICAgICAgICB9KTtcblxuICAgICAgICAvL2lucHV0XG4gICAgICAgIGZvcm0uYWRkRXZlbnRMaXN0ZW5lcignaW5wdXQnLCAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHRhcmdldElucHV0ID0gZXZlbnQudGFyZ2V0O1xuXG4gICAgICAgICAgICBpZiAodGFyZ2V0SW5wdXQuY2xhc3NMaXN0LmNvbnRhaW5zKCd3YXJuaW5nJykpIHtcbiAgICAgICAgICAgICAgICB2YWxpZGF0ZVNpbmdsZUlucHV0KHRhcmdldElucHV0KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgY29uc3QgaXNBbnlJbnB1dEZpbGxlZCA9IEFycmF5LmZyb20oYWxsSW5wdXRzKS5zb21lKGlucHV0ID0+IGlucHV0LnZhbHVlLnRyaW0oKSAhPT0gXCJcIiB8fCBpbnB1dC5jaGVja2VkKTtcbiAgICAgICAgICAgIGlmIChpc0FueUlucHV0RmlsbGVkKSB7XG4gICAgICAgICAgICAgICAgc3VibWl0QnV0dG9uLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBzdWJtaXRCdXR0b24uY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIGNoZWNrIDEgaW5wdXRcbiAgICAgICAgZnVuY3Rpb24gdmFsaWRhdGVTaW5nbGVJbnB1dChpbnB1dCkge1xuICAgICAgICAgICAgaWYgKGlucHV0LnR5cGUgPT09IFwiZGF0ZVwiICYmIGlucHV0LnZhbHVlID09PSBcIjIwMDAtMDEtMDFcIikge1xuICAgICAgICAgICAgICAgIGlucHV0LmNsYXNzTGlzdC5hZGQoJ3dhcm5pbmcnKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoaW5wdXQudmFsdWUudHJpbSgpID09PSBcIlwiIHx8IChpbnB1dC5jbGFzc0xpc3QuY29udGFpbnMoJ2Zvcm1fX2lucHV0LXBob25lJykgJiYgIS9eXFwrMzhcXHMqXFxkezN9XFxzKlxcZHszfVxccypcXGR7Mn1cXHMqXFxkezJ9JC8udGVzdChpbnB1dC52YWx1ZSkpKSB7XG4gICAgICAgICAgICAgICAgaW5wdXQuY2xhc3NMaXN0LmFkZCgnd2FybmluZycpO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChpbnB1dC5jbGFzc0xpc3QuY29udGFpbnMoJ2Zvcm1fX2lucHV0LXJlZ2lvbicpICYmIGlucHV0LnZhbHVlID09PSBcIlwiKSB7XG4gICAgICAgICAgICAgICAgaW5wdXQuY2xhc3NMaXN0LmFkZCgnd2FybmluZycpO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChpbnB1dC5jbGFzc0xpc3QuY29udGFpbnMoJ2Zvcm1fX2lucHV0LWNoZWNrYm94JykgJiYgIWlucHV0LmNoZWNrZWQpIHtcbiAgICAgICAgICAgICAgICBpbnB1dC5jbGFzc0xpc3QuYWRkKCd3YXJuaW5nJyk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGlucHV0LmNsYXNzTGlzdC5jb250YWlucygnZm9ybV9faW5wdXQtcmFkaW8nKSkge1xuICAgICAgICAgICAgICAgIGNvbnN0IGlzUmFkaW9DaGVja2VkID0gQXJyYXkuZnJvbShyYWRpb0lucHV0cykuc29tZShyYWRpbyA9PiByYWRpby5jaGVja2VkKTtcbiAgICAgICAgICAgICAgICBpZiAoIWlzUmFkaW9DaGVja2VkKSB7XG4gICAgICAgICAgICAgICAgICAgIHJhZGlvSW5wdXRzLmZvckVhY2gocmFkaW8gPT4gcmFkaW8uY2xhc3NMaXN0LmFkZCgnd2FybmluZycpKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICByYWRpb0lucHV0cy5mb3JFYWNoKHJhZGlvID0+IHJhZGlvLmNsYXNzTGlzdC5yZW1vdmUoJ3dhcm5pbmcnKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBpbnB1dC5jbGFzc0xpc3QucmVtb3ZlKCd3YXJuaW5nJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvLyB2YWxpZGF0aW9uXG4gICAgICAgIGZ1bmN0aW9uIHZhbGlkYXRlSW5wdXRzKGZvcm0pIHtcbiAgICAgICAgICAgIGxldCBpc1ZhbGlkID0gdHJ1ZTtcbiAgICAgICAgICAgIGxldCBoYXNXYXJuaW5nID0gZmFsc2U7XG5cbiAgICAgICAgICAgIGFsbElucHV0cy5mb3JFYWNoKGlucHV0ID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoaW5wdXQgPT09IHRlbGVncmFtSW5wdXQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmIChpbnB1dC50eXBlID09PSBcImRhdGVcIiAmJiBpbnB1dC52YWx1ZSA9PT0gXCIyMDAwLTAxLTAxXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgaW5wdXQuY2xhc3NMaXN0LmFkZCgnd2FybmluZycpO1xuICAgICAgICAgICAgICAgICAgICBoYXNXYXJuaW5nID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgaXNWYWxpZCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoaW5wdXQudmFsdWUudHJpbSgpID09PSBcIlwiIHx8IChpbnB1dC5jbGFzc0xpc3QuY29udGFpbnMoJ2Zvcm1fX2lucHV0LXBob25lJykgJiYgIS9eXFwrMzhcXHMqXFxkezN9XFxzKlxcZHszfVxccypcXGR7Mn1cXHMqXFxkezJ9JC8udGVzdChpbnB1dC52YWx1ZSkpKSB7XG4gICAgICAgICAgICAgICAgICAgIGlucHV0LmNsYXNzTGlzdC5hZGQoJ3dhcm5pbmcnKTtcbiAgICAgICAgICAgICAgICAgICAgaGFzV2FybmluZyA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIGlzVmFsaWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGlucHV0LmNsYXNzTGlzdC5jb250YWlucygnZm9ybV9faW5wdXQtcmVnaW9uJykgJiYgaW5wdXQudmFsdWUgPT09IFwiXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgaW5wdXQuY2xhc3NMaXN0LmFkZCgnd2FybmluZycpO1xuICAgICAgICAgICAgICAgICAgICBoYXNXYXJuaW5nID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgaXNWYWxpZCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoaW5wdXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdmb3JtX19pbnB1dC1jaGVja2JveCcpICYmICFpbnB1dC5jaGVja2VkKSB7XG4gICAgICAgICAgICAgICAgICAgIGlucHV0LmNsYXNzTGlzdC5hZGQoJ3dhcm5pbmcnKTtcbiAgICAgICAgICAgICAgICAgICAgaGFzV2FybmluZyA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIGlzVmFsaWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGlucHV0LmNsYXNzTGlzdC5jb250YWlucygnZm9ybV9faW5wdXQtcmFkaW8nKSkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBpc1JhZGlvQ2hlY2tlZCA9IEFycmF5LmZyb20ocmFkaW9JbnB1dHMpLnNvbWUocmFkaW8gPT4gcmFkaW8uY2hlY2tlZCk7XG4gICAgICAgICAgICAgICAgICAgIGlmICghaXNSYWRpb0NoZWNrZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJhZGlvSW5wdXRzLmZvckVhY2gocmFkaW8gPT4gcmFkaW8uY2xhc3NMaXN0LmFkZCgnd2FybmluZycpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGhhc1dhcm5pbmcgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgaXNWYWxpZCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmFkaW9JbnB1dHMuZm9yRWFjaChyYWRpbyA9PiByYWRpby5jbGFzc0xpc3QucmVtb3ZlKCd3YXJuaW5nJykpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgaW5wdXQuY2xhc3NMaXN0LnJlbW92ZSgnd2FybmluZycpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBpZiAoaGFzV2FybmluZykge1xuICAgICAgICAgICAgICAgIGZvcm1XYXJuaW5nLmNsYXNzTGlzdC5hZGQoJ3Zpc2libGUnKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgZm9ybVdhcm5pbmcuY2xhc3NMaXN0LnJlbW92ZSgndmlzaWJsZScpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoaXNWYWxpZCkge1xuICAgICAgICAgICAgICAgIHN1Ym1pdEJ1dHRvbi5jbGFzc0xpc3QucmVtb3ZlKCd3YXJuaW5nJyk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHN1Ym1pdEJ1dHRvbi5jbGFzc0xpc3QuYWRkKCd3YXJuaW5nJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBmb3Jtcy5mb3JFYWNoKGZvcm0gPT4ge1xuICAgICAgICAgICAgZm9ybS5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIChldmVudCkgPT4ge1xuICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7IC8vINCX0LDQsdC70L7QutGD0LLQsNGC0Lgg0YHRgtCw0L3QtNCw0YDRgtC90YMg0LLRltC00L/RgNCw0LLQutGDXG5cbiAgICAgICAgICAgICAgICBsZXQgaXNWYWxpZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgY29uc3Qgd2FybmluZ3MgPSBmb3JtLnF1ZXJ5U2VsZWN0b3JBbGwoXCIud2FybmluZ1wiKTtcbiAgICAgICAgICAgICAgICB3YXJuaW5ncy5mb3JFYWNoKHdhcm5pbmcgPT4gd2FybmluZy5jbGFzc0xpc3QucmVtb3ZlKFwid2FybmluZ1wiKSk7IC8vINCe0YfQuNGB0YLQuNGC0Lgg0L/QvtC/0LXRgNC10LTQvdGWINC/0L7QvNC40LvQutC4XG5cbiAgICAgICAgICAgICAgICAvLyDQpNGD0L3QutGG0ZbRjyDQtNC70Y8g0LTQvtC00LDQstCw0L3QvdGPINC/0L7Qv9C10YDQtdC00LbQtdC90L3Rj1xuICAgICAgICAgICAgICAgIGNvbnN0IGFkZFdhcm5pbmcgPSAoaW5wdXQsIG1lc3NhZ2UpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgaXNWYWxpZCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICBpbnB1dC5jbGFzc0xpc3QuYWRkKFwid2FybmluZ1wiKTtcbiAgICAgICAgICAgICAgICAgICAgbGV0IHdhcm5pbmdNZXNzYWdlID0gaW5wdXQubmV4dEVsZW1lbnRTaWJsaW5nO1xuICAgICAgICAgICAgICAgICAgICBpZiAoIXdhcm5pbmdNZXNzYWdlIHx8ICF3YXJuaW5nTWVzc2FnZS5jbGFzc0xpc3QuY29udGFpbnMoXCJmb3JtX193YXJuaW5nXCIpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB3YXJuaW5nTWVzc2FnZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJwXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgd2FybmluZ01lc3NhZ2UuY2xhc3NMaXN0LmFkZChcImZvcm1fX3dhcm5pbmdcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICB3YXJuaW5nTWVzc2FnZS50ZXh0Q29udGVudCA9IG1lc3NhZ2U7XG4gICAgICAgICAgICAgICAgICAgICAgICBpbnB1dC5wYXJlbnROb2RlLmFwcGVuZENoaWxkKHdhcm5pbmdNZXNzYWdlKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICAvLyDQktCw0LvRltC00LDRhtGW0Y8g0YLQtdC60YHRgtC+0LLQuNGFINC/0L7Qu9GW0LJcbiAgICAgICAgICAgICAgICBjb25zdCBzdXJuYW1lID0gZm9ybS5xdWVyeVNlbGVjdG9yKFwiLmZvcm1fX2lucHV0LXN1cm5hbWVcIik7XG4gICAgICAgICAgICAgICAgaWYgKCFzdXJuYW1lLnZhbHVlLnRyaW0oKSkgYWRkV2FybmluZyhzdXJuYW1lLCBcItCf0YDRltC30LLQuNGJ0LUg0L7QsdC+0LIn0Y/Qt9C60L7QstC1XCIpO1xuXG4gICAgICAgICAgICAgICAgY29uc3QgZmlyc3ROYW1lID0gZm9ybS5xdWVyeVNlbGVjdG9yKFwiLmZvcm1fX2lucHV0LWZpcnN0LW5hbWVcIik7XG4gICAgICAgICAgICAgICAgaWYgKCFmaXJzdE5hbWUudmFsdWUudHJpbSgpKSBhZGRXYXJuaW5nKGZpcnN0TmFtZSwgXCLQhtC8J9GPINC+0LHQvtCyJ9GP0LfQutC+0LLQtVwiKTtcblxuICAgICAgICAgICAgICAgIC8vINCS0LDQu9GW0LTQsNGG0ZbRjyDRgtC10LvQtdGE0L7QvdGDXG4gICAgICAgICAgICAgICAgY29uc3QgcGhvbmUgPSBmb3JtLnF1ZXJ5U2VsZWN0b3IoXCIuZm9ybV9faW5wdXQtcGhvbmVcIik7XG4gICAgICAgICAgICAgICAgaWYgKCFwaG9uZS52YWx1ZS50cmltKCkgfHwgIS9eXFwrMzhcXHM/XFxkezN9XFxzP1xcZHszfVxccz9cXGR7Mn1cXHM/XFxkezJ9JC8udGVzdChwaG9uZS52YWx1ZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgYWRkV2FybmluZyhwaG9uZSwgXCLQndC+0LzQtdGAINGC0LXQu9C10YTQvtC90YMg0L7QsdC+0LIn0Y/Qt9C60L7QstC40LlcIik7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy8g0JLQsNC70ZbQtNCw0YbRltGPINC00LDRgtC4INC90LDRgNC+0LTQttC10L3QvdGPXG4gICAgICAgICAgICAgICAgY29uc3QgYmlydGhEYXRlID0gZm9ybS5xdWVyeVNlbGVjdG9yKFwiLmZvcm1fX2lucHV0LWRhdGVcIik7XG4gICAgICAgICAgICAgICAgaWYgKCFiaXJ0aERhdGUudmFsdWUgfHwgYmlydGhEYXRlLnZhbHVlID09PSBcIjIwMDAtMDEtMDFcIikge1xuICAgICAgICAgICAgICAgICAgICBhZGRXYXJuaW5nKGJpcnRoRGF0ZSwgXCLQlNCw0YLQsCDQvdCw0YDQvtC00LbQtdC90L3RjyDQvtCx0L7QsifRj9C30LrQvtCy0LBcIik7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy8g0JLQsNC70ZbQtNCw0YbRltGPINCy0ZbQudGB0YzQutC+0LLQvtGB0LvRg9C20LHQvtCy0YbRj1xuICAgICAgICAgICAgICAgIGNvbnN0IGlzTWlsaXRhcnkgPSBmb3JtLnF1ZXJ5U2VsZWN0b3IoXCIuZm9ybV9faW5wdXQtcmFkaW86Y2hlY2tlZFwiKTtcbiAgICAgICAgICAgICAgICBpZiAoIWlzTWlsaXRhcnkpIGFkZFdhcm5pbmcoZm9ybS5xdWVyeVNlbGVjdG9yKFwiLmZvcm1fX2lucHV0LXJhZGlvXCIpLCBcItCe0LHQtdGA0ZbRgtGMINCy0LDRgNGW0LDQvdGCXCIpO1xuXG4gICAgICAgICAgICAgICAgLy8g0JLQsNC70ZbQtNCw0YbRltGPINC30LPQvtC00Lgg0L3QsCDQvtCx0YDQvtCx0LrRgyDQtNCw0L3QuNGFXG4gICAgICAgICAgICAgICAgY29uc3QgY29uc2VudCA9IGZvcm0ucXVlcnlTZWxlY3RvcihcIi5mb3JtX19pbnB1dC1jaGVja2JveFwiKTtcbiAgICAgICAgICAgICAgICBpZiAoIWNvbnNlbnQuY2hlY2tlZCkgYWRkV2FybmluZyhjb25zZW50LCBcItCS0Lgg0L/QvtCy0LjQvdC90ZYg0L/QvtCz0L7QtNC40YLQuNGB0Y8g0Lcg0L7QsdGA0L7QsdC60L7RjiDQtNCw0L3QuNGFXCIpO1xuXG4gICAgICAgICAgICAgICAgaWYgKGlzVmFsaWQpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZm9ybURhdGEgPSBuZXcgRm9ybURhdGEoZm9ybSk7IC8vXG5cbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3VjY2Vzc01lc3NhZ2UgPSBmb3JtLnF1ZXJ5U2VsZWN0b3IoJy5mb3JtX19zdWNjZXNzJyk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChzdWNjZXNzTWVzc2FnZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc3VjY2Vzc01lc3NhZ2UuY2xhc3NMaXN0LmFkZCgndmlzaWJsZScpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdWNjZXNzTWVzc2FnZS5jbGFzc0xpc3QucmVtb3ZlKCd2aXNpYmxlJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9ybS5yZXNldCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSwgNTAwMCk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3NNZXNzYWdlLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3NNZXNzYWdlLmNsYXNzTGlzdC5yZW1vdmUoJ3Zpc2libGUnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JtLnJlc2V0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGZldGNoKGZvcm0uYWN0aW9uLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgYm9keTogZm9ybURhdGFcbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKHJlc3BvbnNlID0+IHJlc3BvbnNlLnRleHQoKSlcbiAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKGRhdGEgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKGRhdGEpOyAvLyDQktC40LLQtdGB0YLQuCDQstGW0LTQv9C+0LLRltC00Ywg0LLRltC0INGB0LXRgNCy0LXRgNCwXG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzdWNjZXNzTWVzc2FnZSA9IGZvcm0ucXVlcnlTZWxlY3RvcignLmZvcm1fX3N1Y2Nlc3MnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBlcnJvck1lc3NhZ2UgPSBmb3JtLnF1ZXJ5U2VsZWN0b3IoJy5mb3JtX193YXJuaW5nJyk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YS5pbmNsdWRlcyhcItCU0Y/QutGD0ZTQvNC+INC30LAg0LLQsNGI0YMg0LfQsNGP0LLQutGDIVwiKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyDQn9C+0LrQsNC30LDRgtC4INC/0L7QstGW0LTQvtC80LvQtdC90L3RjyDQv9GA0L4g0YPRgdC/0ZbRhVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc3VjY2Vzc01lc3NhZ2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3NNZXNzYWdlLmNsYXNzTGlzdC5hZGQoJ3Zpc2libGUnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3NNZXNzYWdlLmNsYXNzTGlzdC5yZW1vdmUoJ3Zpc2libGUnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JtLnJlc2V0KCk7IC8vINCe0YfQuNGB0YLQuNGC0Lgg0YTQvtGA0LzRg1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgNTAwMCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyDQn9C+0LrQsNC30LDRgtC4INC/0L7QstGW0LTQvtC80LvQtdC90L3RjyDQv9GA0L4g0L/QvtC80LjQu9C60YNcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGVycm9yTWVzc2FnZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3JNZXNzYWdlLnRleHRDb250ZW50ID0gXCLQn9C+0LzQuNC70LrQsCDQv9GA0Lgg0LLRltC00L/RgNCw0LLRhtGWINGE0L7RgNC80LguINCh0L/RgNC+0LHRg9C50YLQtSDRidC1INGA0LDQty5cIjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yTWVzc2FnZS5jbGFzc0xpc3QuYWRkKCd2aXNpYmxlJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGVycm9yID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKFwi0J/QvtC80LjQu9C60LAg0L/RgNC4INCy0ZbQtNC/0YDQsNCy0YbRliDRhNC+0YDQvNC4OlwiLCBlcnJvcik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZXJyb3JNZXNzYWdlID0gZm9ybS5xdWVyeVNlbGVjdG9yKCcuZm9ybV9fd2FybmluZycpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlcnJvck1lc3NhZ2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3JNZXNzYWdlLnRleHRDb250ZW50ID0gXCLQn9C+0LzQuNC70LrQsCDQv9GA0Lgg0LLRltC00L/RgNCw0LLRhtGWINGE0L7RgNC80LguINCh0L/RgNC+0LHRg9C50YLQtSDRidC1INGA0LDQty5cIjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3JNZXNzYWdlLmNsYXNzTGlzdC5hZGQoJ3Zpc2libGUnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG5cbiAgICB9KTtcbn0pO1xuXG5cblxuXG5cbiJdfQ==
